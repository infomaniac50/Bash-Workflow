#!/bin/bash

function config_example()
{
  cat <<EOF
#!/bin/bash
# .coder.sample

# Keep the trailing slashes consistent
# if you want rsync to upload to the right place.

# Local Project Directory
local_='src/'

# Remote Project Directory
remote_='user@example.com:/home/user/public_html/'
EOF

}

function usage()
{
  echo "Usage: ${0##*/} [push|pull] <extra rsync arguments>"
}

function main()
{
  if [[ ! -f ".coder" ]]; then
    echo ".coder does not exist!"
    echo ""
    config_example
    exit 1
  fi

  source ".coder"

  action="$1"
  shift

  case $action in
    "pull" )
      rsync -rlpPsthiD --stats "$remote_" "$local_" "$@"
      ;;
    "push" )
      rsync -rlpPsthiD --stats "$local_" "$remote_" "$@"
      ;;
    * )
      usage
      ;;
  esac

}

main "$@"